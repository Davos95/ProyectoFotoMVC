@using RepositorioPictureManager.Models
@model List<COMISION>

@{
    ViewBag.Title = "Comision";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section events {
    <script>
        $(document).ready(function () {
           

            $("#photo").change(function () {
                readImage(this);
            });
            $("#photo").mouseenter(function () {
                if (this.files[0]) {
                    $("#divPreview").css("display", "block");
                }
            });
            $("#photo").mouseleave(function () {
                    if (this.files[0]) {
                        $("#divPreview").css("display", "none");
                    }
            });



            var origenImagen = "";
            var origenCaja = "";
            var origenTitulo = "";

            var flag = true;
            $(".box")
                .on("dragover", function (e) {
                    //RECOGEMOS INFORMACION DE LA IMAGEN ORIGEN
                    e.preventDefault();
                    if (flag) {
                        origenCaja = $(this).attr("id");
                        origenImagen = $("#" + origenCaja + ">img").attr('src');
                        origenTitulo = $("#" + origenCaja + ">.card-title").text();
                        flag = false;
                    }
                }).on("drop", function (e) {
                    //INTERCAMBIAMOS INFORMACION ENTRE LA IMAGEN ORIGEN Y LA DE DESTINO
                    e.preventDefault();
                    var destinoCaja = $(this).attr('id');
                    var destinoImagen = $("#" + destinoCaja + ">img").attr('src');
                    var destinoTitulo = $("#" + destinoCaja + ">.card-title").text();

                    //Intercambio de imagenes
                    $("#" + destinoCaja + ">img").attr('src', origenImagen);
                    $("#" + origenCaja + ">img").attr("src", destinoImagen);

                    //Intercambio de titulos
                    $("#" + destinoCaja + ">.card-title").text(origenTitulo);
                    $("#" + origenCaja + ">.card-title").text(destinoTitulo);



                    /*
                    var valorOrigen = $("#" + origenCaja + ">input[type=checkbox]").val();
                    var valorDestino = $(".box:nth-child(" + ($(this).index() + 1) + ")>input[type=checkbox]").val();

                    $("#" + origenCaja + ">input[type=checkbox]").val(valorDestino);
                    $(".box:nth-child(" + ($(this).index() + 1) + ")>input[type=checkbox]").val(valorOrigen);
                    */

                    flag = true;

                });

        });

        function readImage(input) {
            if (input.files[0]) {
                var reader = new FileReader();
            } else {
                $("#divPreview").css("display", "none");
            }
            reader.onload = function (e) {
                $("#preview").attr("src", e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
        }

    </script>
}
<div class="row">
    <div class="col s12 m5 l5 xl5 offset-m1 offset-l1 offset-xl1">
        <div class="card">
            <div class="card-title center-align" style="margin:0 !important; padding: 0 !important">Comisión</div>
            <div class="card-content" style="padding-top: 0 !important">
                <form method="post" enctype="multipart/form-data">
                    <div class="input-field">
                        <input type="text" name="name" id="name" />
                        <label for="name">Nombre</label>
                    </div>
                    <div class="input-field">
                        <textarea name="description" id="description" placeholder="Descripcion" style="resize:none; height:70px;"></textarea>
                    </div>
                    <div class="input-field">
                        <input type="file" name="photo" id="photo" />
                        <!-- Preview Div -->
                        <div id="divPreview" style="z-index: 10; display:none; position:absolute;">
                            <div class="card" style="width:70%;">
                                <div class="card-content">
                                    <img id="preview" style="width: 100%; margin:0 auto;" />
                                </div>
                            </div>
                        </div>
                        <!-- End Preview Div-->
                    </div>
                    <div class="input-field">
                        <input type="number" name="price" id="price" min="0" style="width: 150px" /> &nbsp; €
                        <label for="price">Precio</label>
                    </div>
                    <div class="input-field">
                        <button type="submit" name="option" value="0" class="btn waves-effect waves-darken green">Añadir</button>
                        <button type="submit" name="option" value="1" class="btn waves-effect waves-darken orange">Modificar</button>
                        <button type="submit" name="option" value="2" class="btn waves-effect waves-darken red">Eliminar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col s12 m5 l5 xl5">
        <div class="card">
            <div class="card-content">
                @if (Model != null)
                {
                    foreach (COMISION comision in Model)
                    {
                    <div class="card">
                        <div class="card-image" >
                            <div class="box" id="@comision.ID">
                                <img src="@Url.Content(comision.PHOTO)" style="height:150px;" draggable="true" />
                                <div class="card-title">
                                    @comision.NAME
                                </div>
                            </div>
                        </div>
    
                    </div>
                        
                    }
                }

            </div>
        </div>
    </div>
</div>

